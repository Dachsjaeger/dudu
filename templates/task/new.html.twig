<!DOCTYPE html>
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/todo.css') }}">
{% endblock %}

{% block content %}
    <button id="zuruck" value="default">Zur√ºck</button>
    <script>
        document.getElementById("zuruck").addEventListener("click", function() {
            window.location.href = "{{ path('home') }}";
        });
    </script>
    <div class="form-container">
        {{ form_start(form) }}
        <div class="form-field">
            {{ form_label(form.task, 'Aufgabe') }}
            {{ form_widget(form.task) }}
        </div>
        <div class="form-field">
            {{ form_label(form.dueDate, 'Fertig bis:') }}
            {{ form_widget(form.dueDate) }}
        </div>
        <div class="form-field">
            {{ form_label(form.bild, 'Datei (optional)') }}
            {{ form_widget(form.bild) }}
        </div>
        <div class="form-field">
            <label for="{{ form.nimmMeineDaten.vars.id }}">
                {{ form_widget(form.nimmMeineDaten) }}              
            </label>
        </div>
        <div class="form-field">
            {{ form_widget(form.save, { 'label': 'Speichern' }) }}
        </div>
        {{ form_end(form) }}
    </div>
    <div class="all">
        {% for entry in pass %}
            <div class="post">
                <div class="post-field">
                    {{ entry.datum }}
                </div>
                <div class="post-field">
                    {{ entry.Aufgabe }}
                </div>
                    {% if entry.bildName %}
                    {% if entry.bildName ends with ('.png') or entry.bildName ends with ('.jpg') %}
                        <div class="post-field">
                            <div class="pic">
                        <img src="{{ asset('uploads/' ~ entry.bildName) }}" alt="Uploaded Image">
                        </div>
                        </div>
                    {% endif %}
                    {% endif %}
                
                {% if entry.bildName %}
                    <div class="post-field">
                        <a href="{{ asset('uploads/' ~ entry.bildName) }}" download>{{ entry.bildName }}</a>
                    </div>
                {% endif %}
                <div class="post-field">
                    <button type="button" class="btn-delete" data-id="{{ entry.id }}">Fertig</button>
                </div>
            </div>
        {% endfor %}
    </div>
    {% block javascripts %}
    <script>
        const deleteButtons = document.querySelectorAll('.btn-delete');
        deleteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const id = button.getAttribute('data-id');
                if (confirm('Sicher?')) {
                    deleteTask(id);
                }
            });
        });
        function deleteTask(id) {
            fetch(`/delete-task/${id}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        alert('FALSCH');
                    }
                })
        }
    </script>
    {% endblock %}
{% endblock %}

